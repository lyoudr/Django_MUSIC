### ECS Fargate
version : 1
task_definition :
  ecs_network_mode : awsvpc
  task_execution_role : ecsTaskExecutionRole
  task_size :
    mem_limit : 0.5GB
    cpu_limit : 256
  docker_voluems:
    - name: media
      scope: shared
      driver: local
      driver_opts:
        type: nfs
        device: fs-7d9f015d.efs.ap-northeast-1.amazonaws.com:/
        o: addr=fs-7d9f015d.efs.ap-northeast-1.amazonaws.com,nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport
  # efs_volumes :
    # - name: "music"
    #   filesystem_id: "fs-1270e132"
    #   root_directory: /
    #   transit_encryption: ENABLED
    #   access_point: "fsap-05ccc3429c1d9f644"
    #   iam: DISABLED
    # - name: media
    #   filesystem_id: fs-039c0223
    #   root_directory: /
    #   transit_encryption: ENABLED
    # access_point: fsap-0ecd2b007a220a52b
    # iam: DISABLED
  services:
    postgres_db : 
      cpu_shares : 80
      mem_limit : 300MB

    ann_server_1 :
      cpu_shares : 80
      mem_limit : 300MB
      # set "depends_on" in ecs-params instead of setting in docker-copmose.yml
      depends_on : 
        - container_name : postgres_db
          condition : HEALTHY
    nginx :
      cpu_shares : 80
      mem_limit : 400MB
      depends_on:
        - container_name : ann_server_1
          condition : HEALTHY

run_params :
  network_configuration :
    awsvpc_configuration :
      subnets :
        - "subnet-09404f0b49797d74e" # Configuring these subnets "Route Table" to "internet gateway" to make it public subnets
        - "subnet-051007b1fde1ea43b"
      security_groups :
        - "sg-0e84dd0849b3fc954" # the security group have to allow HTTP 80
      assign_public_ip : ENABLED
